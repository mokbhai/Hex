# Ralph Progress Log for Hex Voice
# This file tracks learnings across iterations for autonomous AI development

## Codebase Patterns
- Tauri 2.0 projects use create-tauri-app with template react-ts
- TypeScript strict mode is enabled by default in Tauri React templates
- Vite is the default build tool for Tauri 2.0 frontend
- Tauri commands are registered in src-tauri/src/lib.rs with #[tauri::command]
- All Tauri frontend code goes in src/ directory
- All Rust backend code goes in src-tauri/src/ directory
- Tailwind CSS v3 uses tailwind.config.js with content paths for class scanning
- Tailwind directives (@tailwind base/components/utilities) go in index.css
- PostCSS config uses ESM export syntax with tailwindcss and autoprefixer plugins
- macOS entitlements are configured in src-tauri/entitlements.plist for App Sandbox permissions
- macOS Info.plist entries go in src-tauri/Info.plist for privacy usage descriptions
- tauri.conf.json bundle.macOS section references both entitlements and infoPlist files

---

## 2025-02-09 - E1-1 - Initialize Tauri 2.0 project with React + TypeScript

**What was implemented:**
- Created Tauri 2.0 project with React + TypeScript using create-tauri-app
- Configured TypeScript with strict mode (already enabled by template)
- Set up Vite as build tool for frontend
- Initialized Rust backend with Tauri dependencies
- Configured basic macOS app structure

**Files changed:**
- package.json, tsconfig.json, vite.config.ts - Frontend build configuration
- src-tauri/Cargo.toml, src-tauri/build.rs - Rust build configuration
- src-tauri/tauri.conf.json - Tauri app configuration
- src-tauri/src/main.rs, src-tauri/src/lib.rs - Rust entry points
- src/App.tsx, src/main.tsx - React entry points
- .gitignore - Updated for Tauri/node_modules

**Learnings for future iterations:**
- The create-tauri-app command creates files in a subdirectory by default; need to move contents to root
- Tauri 2.0 uses capabilities system in src-tauri/capabilities/default.json for permissions
- Hot reload works automatically with Vite dev server on port 1420
- The app identifier defaults to com.<author>.<appname> in tauri.conf.json
- cargo check must be run from src-tauri directory or with --manifest-path flag

---

## 2025-02-09 - E1-2 - Configure build tools (Vite, Tailwind CSS)

**What was implemented:**
- Installed Tailwind CSS v3 with PostCSS and Autoprefixer
- Created tailwind.config.js with content path configuration for scanning src directory
- Created postcss.config.js for PostCSS processing
- Created src/index.css with Tailwind directives (base, components, utilities)
- Updated main.tsx to import index.css for Tailwind styles

**Files changed:**
- package.json - Added tailwindcss, postcss, autoprefixer as dev dependencies
- tailwind.config.js - New Tailwind configuration with content paths
- postcss.config.js - New PostCSS configuration
- src/index.css - New file with Tailwind directives
- src/main.tsx - Added index.css import

**Learnings for future iterations:**
- Tailwind CSS v4 has breaking changes and different configuration; use v3.x for stability
- Tailwind v3 requires content paths in config to scan for utility classes
- The @tailwind directives must be in a CSS file imported by the main entry point
- Vite bundles CSS efficiently (6.42 kB for base Tailwind styles)
- Source maps are enabled by default in Vite for debugging

---

## 2025-02-09 - E1-3 - Add Rust dependencies (cpal, arboard, async-openai, tokio, serde)

**What was implemented:**
- Added cpal v0.15 for audio device enumeration and recording
- Added arboard v3.6 for clipboard access
- Added async-openai v0.25 for OpenAI API integration
- Added tokio v1 with full features for async runtime

**Files changed:**
- src-tauri/Cargo.toml - Added cpal, arboard, async-openai, tokio dependencies
- src-tauri/Cargo.lock - Updated with new dependency tree

**Learnings for future iterations:**
- cpal requires platform-specific audio backends (coreaudio-rs on macOS)
- arboard provides cross-platform clipboard access
- async-openai is a Rust client for the OpenAI API
- tokio "full" features include everything needed for async I/O, time, and sync
- Newer versions of some crates may be available (e.g., async-openai v0.32, cpal v0.17)

---

## 2025-02-09 - E1-4 - Add and configure Tauri plugins (global-shortcut, store, dialog, fs, shell, log)

**What was implemented:**
- Added tauri-plugin-global-shortcut for system-wide hotkeys
- Added tauri-plugin-store for settings persistence
- Added tauri-plugin-dialog for native dialogs
- Added tauri-plugin-fs for file system access
- Added tauri-plugin-shell for opening URLs and executing commands
- Added tauri-plugin-log for logging
- Registered all plugins in lib.rs with Builder pattern
- Configured default permissions in capabilities/default.json

**Files changed:**
- src-tauri/Cargo.toml - Added all Tauri plugin dependencies
- src-tauri/src/lib.rs - Registered all plugins with tauri::Builder
- src-tauri/capabilities/default.json - Added plugin permissions

**Learnings for future iterations:**
- Tauri 2.0 uses a capabilities system for permissions (not in tauri.conf.json)
- Capabilities are defined in src-tauri/capabilities/*.json files
- Each plugin has "default" permissions that include common operations
- global-shortcut and store plugins use Builder::new().build() pattern
- Some plugins like dialog, fs, shell use init() directly
- Plugin permissions must be explicitly listed or use "default" shorthand
- fs:default includes scoped permissions (appdata, config, etc.) not generic paths

---

## 2025-02-09 - E1-5 - Set up project folder structure

**What was implemented:**
- Created Rust module folders: audio/, transcription/, clipboard/, hotkey/, refinement/, store/, models/
- Added mod.rs files for all modules with placeholder exports
- Added stub implementations for module sub-files with basic types
- Created frontend folders: components/, hooks/, stores/, types/, utils/
- Added chrono (with serde feature) and uuid dependencies for data models
- Updated README with project structure documentation

**Files changed:**
- src-tauri/src/lib.rs - Added module declarations
- src-tauri/src/audio/ - Audio recording module (recorder.rs, device.rs, mod.rs)
- src-tauri/src/transcription/ - Speech-to-text module (engine.rs, model.rs, mod.rs)
- src-tauri/src/clipboard/ - Text injection module (clipboard.rs, mod.rs)
- src-tauri/src/hotkey/ - Global hotkey module (hotkey.rs, press_and_hold.rs, double_tap.rs, mod.rs)
- src-tauri/src/refinement/ - LLM text refinement (refinement.rs, prompt.rs, mod.rs)
- src-tauri/src/store/ - Settings persistence (settings.rs, history.rs, mod.rs)
- src-tauri/src/models/ - Data models (transcription.rs, settings.rs, history.rs, mod.rs)
- src/components/, src/hooks/, src/stores/, src/types/, src/utils/ - Frontend folders
- README.md - Added project structure documentation

**Learnings for future iterations:**
- Rust modules need both a folder with mod.rs and individual .rs files for submodules
- Naming a struct `Device` conflicts with `cpal::Device`; use descriptive names like `AudioDevice`
- chrono requires the "serde" feature to work with Serialize/Deserialize derives
- Use uuid::Uuid::new_v4().to_string() for generating unique IDs
- Stub implementations with empty structs are enough for module structure setup

---

## 2025-02-09 - E1-6 - Configure macOS code signing and entitlements

**What was implemented:**
- Created entitlements.plist with macOS App Sandbox permissions (audio input, network client/server, file access, app groups)
- Created Info.plist with privacy usage descriptions for microphone, accessibility, and Apple Events
- Configured macOS bundle settings in tauri.conf.json (entitlements path, infoPlist path, minimum system version)
- Added documentation comments to build.rs about entitlements handling

**Files changed:**
- src-tauri/entitlements.plist - New file with App Sandbox entitlements
- src-tauri/Info.plist - New file with privacy usage descriptions and app configuration
- src-tauri/tauri.conf.json - Added macOS bundle configuration
- src-tauri/build.rs - Added documentation comments

**Learnings for future iterations:**
- Tauri 2.0 uses entitlements.plist for App Sandbox permissions (audio, network, file access)
- Info.plist requires NSMicrophoneUsageDescription for microphone access permission prompt
- Info.plist requires NSAccessibilityUsageDescription for accessibility permission prompt
- Info.plist requires NSAppleEventsUsageDescription for Apple Events permission (for CGEvent keyboard simulation)
- LSUIElement=false in Info.plist controls dock icon visibility (set to true for menu bar only apps)
- get-task-allow entitlement is needed for development builds (can be removed for production)
- tauri_build::build() automatically handles entitlements and Info.plist merging
- Minimum system version is set in tauri.conf.json bundle.macOS.minimumSystemVersion

---
